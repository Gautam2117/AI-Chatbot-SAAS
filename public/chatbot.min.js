/* Botify Chat Widget (min) – same features, compact build */
(function(){const e=document.currentScript,t=e.getAttribute("data-user-id")||"guest-user",n=e.getAttribute("data-brand")||"Botify",o=e.getAttribute("data-color")||"#7C3AED",i=e.getAttribute("data-font")||"Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",a=e.getAttribute("data-border-radius")||"22px",r=(e.getAttribute("data-position")||"bottom-right").toLowerCase(),s="false"!==e.getAttribute("data-draggable"),l=e.getAttribute("data-logo")||"https://ai-chatbot-saas-eight.vercel.app/chatbot_widget_logo.png",c="false"!==e.getAttribute("data-poweredby"),d="https://ai-chatbot-backend-h669.onrender.com";let p=localStorage.getItem("botify:lang")||"en";const u={en:{welcome:"Hello! How can I assist you today?",send:"Send",typing:`${n} is typing…`,mic:"🎤",placeholder:"Type a message…",online:"Online",offline:"Unavailable",help:"💡 Need help with something? Just ask!"},hi:{welcome:"नमस्ते! मैं आपकी कैसे मदद कर सकता हूँ?",send:"भेजें",typing:`${n} लिख रहा है…`,mic:"🎤",placeholder:"संदेश लिखें…",online:"ऑनलाइन",offline:"उपलब्ध नहीं",help:"💡 किसी मदद की ज़रूरत है? पूछिए!"},es:{welcome:"¡Hola! ¿En qué puedo ayudarte hoy?",send:"Enviar",typing:`${n} está escribiendo…`,mic:"🎤",placeholder:"Escribe un mensaje…",online:"En línea",offline:"No disponible",help:"💡 ¿Necesitas ayuda? ¡Pregunta!"},fr:{welcome:"Bonjour ! Comment puis-je vous aider ?",send:"Envoyer",typing:`${n} est en train d’écrire…`,mic:"🎤",placeholder:"Écrivez un message…",online:"En ligne",offline:"Indisponible",help:"💡 Besoin d’aide ? Demandez !"},zh:{welcome:"你好！我能为您做些什么？",send:"发送",typing:`${n} 正在输入…`,mic:"🎤",placeholder:"输入消息…",online:"在线",offline:"不可用",help:"💡 需要帮助吗？尽管问！"},ar:{welcome:"مرحبًا! كيف يمكنني مساعدتك؟",send:"إرسال",typing:`${n} يكتب…`,mic:"🎤",placeholder:"اكتب رسالة…",online:"متصل",offline:"غير متاح",help:"💡 هل تحتاج مساعدة؟ اسأل!"}},m=e=>u[p]&&u[p][e]||u.en[e]||e,g=r.includes("left"),h=`bottom:24px; ${g?"left":"right"}:24px;`,y=document.createElement("style");y.textContent=`:root{--botify-primary:${o};--botify-font:${i};--botify-radius:${a}}.botify__launcher{position:fixed;${h}width:68px;height:68px;border:0;background:transparent;cursor:pointer;z-index:9999}.botify__badge{position:absolute;top:-4px;${g?"left":"right"}:-4px;min-width:20px;height:20px;padding:0 6px;font:700 11px/20px var(--botify-font);color:#fff;text-align:center;background:#EF4444;border-radius:999px;box-shadow:0 4px 12px rgba(0,0,0,.25);display:none}.botify__launcher-img{width:100%;height:100%;border-radius:50%;box-shadow:0 14px 30px rgba(0,0,0,.28);transition:transform .25s ease,box-shadow .25s ease}.botify__launcher:hover .botify__launcher-img{transform:scale(1.06);box-shadow:0 18px 40px rgba(0,0,0,.35)}.botify__pulse::after{content:"";position:absolute;inset:0;border-radius:999px;z-index:-1;box-shadow:0 0 0 0 var(--botify-primary);animation:botifyPulse 2s infinite}@keyframes botifyPulse{0%{box-shadow:0 0 0 0 rgba(124,58,237,.35)}70%{box-shadow:0 0 0 26px rgba(124,58,237,0)}100%{box-shadow:0 0 0 0 rgba(124,58,237,0)}}.botify__wrap{position:fixed;${h}z-index:9999;display:none;width:392px;max-height:680px;overflow:hidden;border-radius:var(--botify-radius);background:rgba(255,255,255,.94);backdrop-filter:blur(16px);box-shadow:0 34px 70px rgba(0,0,0,.28);font-family:var(--botify-font);color:#0f172a;transform:translateY(30px);opacity:0;animation:botifyIn .35s ease forwards}@keyframes botifyIn{to{transform:translateY(0);opacity:1}}@media (max-width:480px){.botify__wrap{width:calc(100vw - 18px);height:calc(100vh - 18px);max-height:none;${g?"left:9px":"right:9px"};bottom:9px;border-radius:18px}}.botify__header{display:flex;align-items:center;gap:10px;padding:12px;color:#fff;background:linear-gradient(135deg,var(--botify-primary),#EC4899);position:relative;cursor:grab;user-select:none}.botify__brand{display:flex;align-items:center;gap:10px;min-width:0;flex:1}.botify__logo{width:40px;height:40px;border-radius:50%;object-fit:cover}.botify__title{font-weight:800;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.botify__status{font-size:11px;opacity:.9;display:flex;align-items:center;gap:6px}.botify__dot{width:8px;height:8px;border-radius:50%;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.2)}.botify__ctrls{display:flex;align-items:center;gap:8px}.botify__select{appearance:none;border:0;border-radius:10px;padding:6px 10px;background:#ffffff;color:#1f2937;font-size:12px;cursor:pointer;transition:background .2s ease}.botify__select:hover{background:#f3f4f6}.botify__select option{color:#1f2937;background:#ffffff}.botify__btn{border:0;border-radius:10px;padding:6px 10px;background:rgba(255,255,255,.22);color:#fff;font-size:12px;cursor:pointer;transition:background .2s ease}.botify__btn:hover{background:rgba(255,255,255,.34)}.botify__messages{background:linear-gradient(180deg,#F8FAFC,#EEF2FF);padding:14px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;height:420px}.botify__row{display:flex;gap:8px}.botify__bubble{max-width:78%;padding:12px 16px;border-radius:20px;line-height:1.45;box-shadow:0 2px 10px rgba(2,6,23,.08)}.botify__bubble--bot{background:#fff;border-top-left-radius:8px}.botify__bubble--me{margin-left:auto;background:#E0EAFF;border-top-right-radius:8px}.botify__chips{display:flex;flex-wrap:wrap;gap:8px;padding:0 12px 10px}.botify__chip{background:#fff;border:1px solid rgba(99,102,241,.2);color:#4f46e5;padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}.botify__chip:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(79,70,229,.2)}.botify__input{display:flex;align-items:center;gap:6px;padding:10px;border-top:1px solid rgba(99,102,241,.18);background:rgba(255,255,255,.75)}.botify__field{flex:1;border:0;background:transparent;padding:12px;outline:none;font-size:14px}.botify__send,.botify__mic{border:0;cursor:pointer;border-radius:999px;width:40px;height:40px;display:grid;place-items:center;transition:transform .1s ease,box-shadow .2s ease,background .2s ease}.botify__send{background:var(--botify-primary);color:#fff;box-shadow:0 10px 22px rgba(79,70,229,.35)}.botify__mic{background:#EEF2FF;color:var(--botify-primary)}.botify__send:hover{transform:translateY(-1px)}.botify__mic:hover{background:#E0EAFF}.botify__footer{font-size:10px;color:#64748b;text-align:center;padding:6px 0 10px}.botify__footer a{color:var(--botify-primary);font-weight:700;text-decoration:none}.botify__typing{display:flex;align-items:center;gap:8px;color:#334155}.botify__dots{display:flex;gap:4px}.botify__dotpulse{width:8px;height:8px;background:var(--botify-primary);border-radius:50%;animation:dot 1.2s infinite ease-in-out;opacity:.7}.botify__dotpulse:nth-child(2){animation-delay:.15s}.botify__dotpulse:nth-child(3){animation-delay:.3s}@keyframes dot{0%,80%,100%{transform:scale(.75);opacity:.35}40%{transform:scale(1.15);opacity:1}}.botify--dark .botify__wrap{background:rgba(17,24,39,.9);color:#e5e7eb}.botify--dark .botify__messages{background:linear-gradient(180deg,#0f172a,#111827)}.botify--dark .botify__bubble--bot{background:#0B1020;color:#e5e7eb}.botify--dark .botify__bubble--me{background:#1E293B;color:#e5e7eb}.botify--dark .botify__input{background:rgba(17,24,39,.84);border-top-color:rgba(99,102,241,.2)}.botify--dark .botify__mic{background:#0B1020;color:#c7d2fe}`,document.head.appendChild(y);const f=document.createElement("button");f.className="botify__launcher botify__pulse",f.setAttribute("aria-label","Open chat"),f.innerHTML=`<span class="botify__badge" id="botifyBadge">1</span><img class="botify__launcher-img" src="${l}" alt="${n} Chat" />`,document.body.appendChild(f);const b=document.createElement("div");b.className="botify__wrap",b.setAttribute("role","dialog"),b.setAttribute("aria-label",`${n} Chat`),b.setAttribute("aria-live","polite"),b.style.display="none",b.innerHTML=`<div class="botify__header" id="botifyHeader"><div class="botify__brand" title="${n}"><img class="botify__logo" src="${l}" alt="${n}"/><div style="min-width:0"><div class="botify__title">${n} Chat</div><div class="botify__status"><span class="botify__dot" id="botifyStatusDot"></span><span id="botifyStatusText">Online</span></div></div></div><div class="botify__ctrls"><select class="botify__select" id="botifyLang">${Object.keys(u).map(e=>`<option value="${e}" ${e===p?"selected":""}>${e.toUpperCase()}</option>`).join("")}</select><button class="botify__btn" id="botifyTheme" title="Toggle theme">🌙</button><button class="botify__btn" id="botifyClose" title="Close">✕</button></div></div><div class="botify__messages" id="botifyMsgs"></div><div class="botify__chips" id="botifyChips"></div><div class="botify__input"><input class="botify__field" id="botifyField" type="text" placeholder="${m("placeholder")}" /><button class="botify__mic" id="botifyMic" title="Voice">🎤</button><button class="botify__send" id="botifySend" title="${m("send")}">➤</button></div>${c?`<div class="botify__footer">Powered by <a target="_blank" href="https://botify-website.vercel.app/">Botify</a></div>`:""}`,document.body.appendChild(b);const v=e=>b.querySelector("#"+e),w=v("botifyMsgs"),x=v("botifyField"),S=v("botifySend"),E=v("botifyMic"),C=v("botifyClose"),T=v("botifyTheme"),L=v("botifyLang"),B=document.getElementById("botifyHeader"),O=document.getElementById("botifyBadge"),k=v("botifyStatusDot"),D=v("botifyStatusText"),P=v("botifyChips"),_=((e,t)=>localStorage.setItem("botify:"+e,String(t))),q=(e,t)=>localStorage.getItem("botify:"+e)??t;function M(e){k.style.background=e?"#22c55e":"#ef4444",D.textContent=e?m("online"):m("offline")}function A(e){O&&(e>0?(O.style.display="inline-block",O.textContent=String(e)):O.style.display="none")}let I=Number(q("unread","1"));A(I);function H(){b.style.display="block",setTimeout(()=>x.focus(),50),A(0),_("unread","0")}function R(){b.style.display="none"}function z(e,t=!1,n=!1){const o=document.createElement("div");o.className="botify__row";const i=document.createElement("div");return i.className=`botify__bubble ${t?"botify__bubble--me":"botify__bubble--bot"}`,n?i.innerHTML=e:i.textContent=e,o.appendChild(i),w.appendChild(o),w.scrollTop=w.scrollHeight,!t&&"none"===b.style.display&&(I+=1,A(I),_("unread",String(I))),i}function F(){const e=document.createElement("div");e.className="botify__row";const t=document.createElement("div");return t.className="botify__bubble botify__bubble--bot",t.innerHTML=`<div class="botify__typing"><div class="botify__dots"><span class="botify__dotpulse"></span><span class="botify__dotpulse"></span><span class="botify__dotpulse"></span></div><span>${m("typing")}</span></div>`,e.appendChild(t),w.appendChild(e),w.scrollTop=w.scrollHeight,e}["What can you do?","How do I integrate the widget?","Show pricing plans","Contact support"].forEach(e=>{const t=document.createElement("button");t.className="botify__chip",t.textContent=e,t.addEventListener("click",()=>{x.value=e,S.click()}),P.appendChild(t)}),f.addEventListener("click",()=>{"none"===b.style.display?H():R()}),C.addEventListener("click",R),x.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),S.click())})),L.addEventListener("change",(e=>{p=e.target.value,x.placeholder=m("placeholder"),_("lang",p)}));const j=q("theme","light");"dark"===j&&document.body.classList.add("botify--dark"),T.textContent="dark"===j?"☀️":"🌙",T.addEventListener("click",()=>{const e=document.body.classList.toggle("botify--dark");T.textContent=e?"☀️":"🌙",_("theme",e?"dark":"light")}),"webkitSpeechRecognition"in window||"SpeechRecognition"in window?(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition,t=new e;t.lang="en-US",t.interimResults=!1,t.maxAlternatives=1,E.addEventListener("click",(()=>t.start())),t.onresult=e=>{x.value+=e.results[0][0].transcript+" ",x.focus()}})():E.style.display="none",s&&window.matchMedia("(pointer:fine)").matches&&(()=>{let e=!1,t=0,n=0,o=0,i=0;const a=i=>{e=!0,B.style.cursor="grabbing";const a=b.getBoundingClientRect();o=a.left,i=a.top,t=i.clientX,n=i.clientY,document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)},r=i=>{if(!e)return;const a=i.clientX-t,r=i.clientY-n;b.style.left=o+a+"px",b.style.top=i+r+"px",b.style.right="auto",b.style.bottom="auto"},s=()=>{e=!1,B.style.cursor="grab",document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)};B.addEventListener("mousedown",a)})(),function(){let e=null,t=!1;B.addEventListener("touchstart",(t=>{e=t.touches[0].clientY,t=!1}),{passive:!0}),B.addEventListener("touchmove",(n=>{if(null==e)return;const o=n.touches[0].clientY-e;if(o>10){t=!0,b.style.transform=`translateY(${Math.min(o,140)}px)`,b.style.opacity=String(Math.max(.3,1-o/300))}}),{passive:!true}),B.addEventListener("touchend",(()=>{if(!t){e=null;return}const n=getComputedStyle(b).transform;let o=0;if(n&&"none"!==n){const e=n.replace("matrix(","").replace(")","").split(",");e.length>=6&&(o=Math.abs(parseFloat(e[5])||0))}o>120&&R(),b.style.transform="translateY(0px)",b.style.opacity="1",e=null}),{passive:!0})}();async function N(e){z(e,!0),x.value="";const n=F();try{const o=await fetch(`${d}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":t},body:JSON.stringify({question:e,lang:p,faqs:[]})});if(403===o.status){n.remove(),M(!1),z("<strong>🙏 We're currently unavailable</strong><br/>The team reached its daily usage limit. Please try again later.",!1,!0),W(!0);return}if(M(!0),!o.body){n.remove(),z("⚠️ Streaming not supported by this browser.");return}const i=o.body.getReader(),a=new TextDecoder("utf-8");n.remove();const r=z("",!1);let s="";for(;;){const{value:e,done:t}=await i.read();if(t)break;const n=a.decode(e,{stream:!0});s+=n,r.textContent=s,w.scrollTop=w.scrollHeight}s||(r.textContent="⚠️ No response")}catch(e){n.remove(),M(!1),z("❌ Unable to connect. Please try again later.")}}S.addEventListener("click",()=>{const e=x.value.trim();e&&N(e)});function W(e=!0){x.disabled=e,S.disabled=e,E.disabled=e,b.style.opacity=e?".65":"1",x.placeholder=e?"Support is currently unavailable.":m("placeholder")}z(m("welcome")),setTimeout(()=>z(m("help")),12000),(async function(){try{const e=await fetch(`${d}/api/usage-status`,{headers:{"x-user-id":t}}),n=await e.json();n.blocked?(M(!1),z("🚫 <strong>Chat temporarily unavailable</strong><br/>Our support team reached its daily limit.",!1,!0),W(!0)):(M(!0),W(!1))}catch(e){}})(),setInterval(async()=>{try{const e=await fetch(`${d}/api/usage-status`,{headers:{"x-user-id":t}}),n=await e.json();n.blocked||(M(!0),W(!1))}catch(e){}},3e5)})();
